# Specification: Integration of Audio Management and Enhanced Transcription

## Overview
This track focuses on integrating `LocalAudioManager`, `WebAudioRecorder`, and `WhisperTranscription` into the `MonologLiveApp` (main.ts). The goal is to capture high-quality audio recordings of sessions, store them locally, and provide an on-demand "Enhanced Transcription" feature using Whisper (Transformers.js) to improve upon the real-time Web Speech API results.

## Functional Requirements

### 1. Audio Recording Integration
- **Initialization:** `WebAudioRecorder` and `LocalAudioManager` (using the existing `IndexedDBWrapper`) should be initialized within `MonologLiveApp`.
- **Lifecycle Sync:** 
    - When `startSession()` is called, the audio recording must start automatically.
    - When `stopSession()` is called, the audio recording must stop.

### 2. Audio Storage Management
- **Automatic Saving:** Immediately after a session stops, the resulting `AudioFile` blob must be saved to IndexedDB via `LocalAudioManager`.
- **Session Association:** Ensure the audio file is correctly associated with the `currentSessionId`.

### 3. On-Demand Enhanced Transcription
- **Trigger UI:** After a session ends, a "Run Enhanced Transcription" button should appear in the application's status or control area.
- **Model Loading:** The Whisper model should be loaded only when the user triggers the transcription to conserve resources.
- **Transcription Process:** 
    - Retrieve the audio blob for the last session.
    - Run `WhisperTranscription.transcribeAudio()`.
- **Result Display:** Once transcription is complete, the `TranscriptionDisplay` should be updated or replaced with the higher-accuracy text and segments generated by Whisper.

## Non-Functional Requirements
- **Resource Efficiency:** Avoid loading heavy AI models until explicitly requested.
- **Error Handling:** Gracefully handle cases where microphone access is denied or IndexedDB is full.
- **Feedback:** Provide visual feedback (e.g., "Transcribing...") during the enhanced transcription process.

## Acceptance Criteria
- [ ] Audio recording starts/stops in sync with the session.
- [ ] Recorded audio is persisted in IndexedDB and viewable/retrievable via logs or internal storage check.
- [ ] A button to trigger Enhanced Transcription appears after a session ends.
- [ ] Clicking the button successfully runs Whisper and updates the transcription UI with new results.

## Out of Scope
- Management/playback of past session audio files (to be handled in a future "History" track).
- Background transcription during the session.
